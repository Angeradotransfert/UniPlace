{% extends "base.html" %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Baloo 2', cursive;
        background: #f5f7fa;
        color: #2c3e50;
    }
    .form-container {
        max-width: 900px;
        margin: 40px auto;
        background: white;
        padding: 30px 40px;
        border-radius: 18px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    h3 {
        font-weight: 700;
        margin-bottom: 20px;
        color: #34495e;
    }
    label {
        display: block;
        margin-top: 16px;
        font-weight: 600;
        color: #34495e;
    }
    select, input[type="text"], input[type="number"], textarea {
        width: 100%;
        padding: 12px 14px;
        border: 1.5px solid #ccc;
        border-radius: 10px;
        margin-top: 6px;
        font-size: 1rem;
        transition: border-color 0.3s;
    }
    select:focus, input[type="text"]:focus, input[type="number"]:focus, textarea:focus {
        border-color: #3498db;
        outline: none;
    }
    textarea {
        resize: vertical;
        min-height: 120px;
    }
    .variant-row {
        display: flex;
        gap: 10px;
        margin-top: 12px;
    }
    .variant-row input {
        flex: 1;
        padding: 10px 12px;
        font-size: 0.95rem;
    }
    .btn-add, .btn-remove {
        margin-top: 12px;
        padding: 10px 18px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.3s;
    }
    .btn-add {
        background-color: #2980b9;
        color: white;
    }
    .btn-add:hover {
        background-color: #1c5980;
    }
    .btn-remove {
        background-color: #e74c3c;
        color: white;
        flex-shrink: 0;
        width: 36px;
        font-size: 1.2rem;
        line-height: 1;
    }
    .btn-remove:hover {
        background-color: #b63122;
    }
    .btn-publish {
        margin-top: 30px;
        background-color: #27ae60;
        color: white;
        font-size: 1.2rem;
        padding: 14px 30px;
        border: none;
        border-radius: 14px;
        cursor: pointer;
        display: block;
        width: 100%;
        font-weight: 700;
        transition: background-color 0.3s;
    }
    .btn-publish:hover {
        background-color: #1e8449;
    }
    .example-title {
        font-style: italic;
        color: #7f8c8d;
        margin-top: 6px;
        font-size: 0.95rem;
    }

    /* Styles g√©n√©raux */
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
  }

  /* Media Query pour les petits √©crans (mobile) */
  @media screen and (max-width: 768px) {
    body {
      font-size: 14px;
    }

    .menu {
      display: none; /* Par exemple, on cache le menu principal pour mobile */
    }

    .menu-mobile {
      display: block; /* On montre un menu mobile */
    }

    .header {
      text-align: center;
    }
  }

  /* Media Query pour les √©crans plus grands (tablette et plus) */
  @media screen and (min-width: 769px) {
    .menu {
      display: block;
    }

    .menu-mobile {
      display: none;
    }
  }
</style>

<div class="form-container">
    <form action="{{ url_for('listings.new_listing') }}" method="POST" enctype="multipart/form-data">

        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">



        <!-- Cat√©gorie et Sous-cat√©gorie -->
        <h3>üìÇ {{ _('Cat√©gorie & Sous-cat√©gorie') }}</h3>
<label for="category">{{ _('Cat√©gorie') }} :</label>
<select name="category" id="category" required>
    <option value="">{{ _('-- Cat√©gorie --') }}</option>
    <option value="√âtudes & Livres">{{ _('üìö √âtudes & Livres') }}</option>
    <option value="√âlectronique & Informatique">{{ _('üíª √âlectronique & Informatique') }}</option>
    <option value="V√™tements & Mode">{{ _('üß• V√™tements & Mode') }}</option>
    <option value="Meubles & Maison">{{ _('üõãÔ∏è Meubles & Maison') }}</option>
    <option value="Logement √©tudiant">{{ _('üè† Logement √©tudiant') }}</option>
    <option value="Cuisine & Produits alimentaires">{{ _('üßë‚Äçüç≥ Cuisine & Produits alimentaires') }}</option>
    <option value="Voyages & Mobilit√©">{{ _('‚úàÔ∏è Voyages & Mobilit√©') }}</option>
    <option value="Services entre √©tudiants">{{ _('üë∑ Services entre √©tudiants') }}</option>
    <option value="Annonces diverses">{{ _('üì£ Annonces diverses') }}</option>
    <option value="Demandes & Recherches">{{ _('üîç Demandes & Recherches') }}</option>
</select>

        <label for="subcategory">{{ _('Sous-cat√©gorie') }} :</label>
             <select name="subcategory" id="subcategory" required>
             <option value="">{{ _('-- Sous-cat√©gorie --') }}</option>
        </select>

        <!-- Titre et Description -->
        <h3>üìù {{ _('Informations sur l‚Äôannonce') }}</h3>
        <label for="title">{{ _('Titre') }} :</label>
        <input type="text" name="title" id="title" placeholder="{{ _('Ex: Titre de votre annonce') }}" required>
        <div class="example-title" id="title-example"></div>

        <label for="description">{{ _('Description') }} :</label>
        <textarea name="description" id="description" rows="5" required></textarea>

        <!-- Prix et Monnaie -->
        <label for="price">{{ _('Prix') }} :</label>
        <input type="number" name="price" id="price" min="0" step="0.01" required>

        <label for="original_price">{{ _('Prix initial (avant r√©duction)') }} :</label>
        <input type="number" name="original_price" id="original_price" step="0.01" placeholder="{{ _('Ex : 100.00') }}">

        <label for="discount_price">{{ _('Prix promotionnel') }} :</label>
        <input type="number" name="discount_price" id="discount_price" step="0.01" placeholder="{{ _('Ex : 79.00') }}">

        <label for="promo_start">{{ _('Date de d√©but de la promotion') }} :</label>
        <input type="datetime-local" name="promo_start" id="promo_start">

        <label for="promo_end">{{ _('Date de fin de la promotion') }} :</label>
        <input type="datetime-local" name="promo_end" id="promo_end">


        <label for="delivery_fee">{{ _('Frais de livraison estim√©s (‚ÇΩ)') }} :</label>
        <input type="number" name="delivery_fee" id="delivery_fee" step="0.01" min="0" required>

        <label for="global_stock">{{ _('Stock global') }} :</label>
        <input type="number" name="global_stock" id="global_stock" min="0" step="1" required>



       <label for="currency">{{ _('Monnaie') }} :</label>
<select name="currency" id="currency" required>
    <option value="RUB">{{ _('‚ÇΩ RUB') }}</option>
    <option value="USDT">{{ _('USDT') }}</option>
    <option value="USD">{{ _('$ USD') }}</option>
    <option value="EUR">{{ _('‚Ç¨ EUR') }}</option>
    <option value="XOF">{{ _('CFA (XOF)') }}</option>  <!-- Nouvelle option pour CFA -->
</select>


        <!-- Condition et Ville -->
        <label for="condition">{{ _('Condition') }} :</label>
        <select name="condition" id="condition" required>
            <option value="">{{ _('-- Choisir --') }}</option>
            <option value="Neuf">{{ _('Neuf') }}</option>
            <option value="Occasion">{{ _('Occasion') }}</option>
        </select>

        <label for="city">{{ _('Ville') }} :</label>
        <input type="text" name="city" id="city" required>

        <!-- Section Variantes (visible dynamiquement) -->
        <div id="variants-section" style="display:none;">
            <h3>üßµ {{ _('Variantes (Tailles / Couleurs / Stock)') }}</h3>
            <div id="variants-container"></div>
            <button type="button" class="btn-add" onclick="addVariantRow()">+ {{ _('Ajouter variant') }}</button>
        </div>

        <!-- Caract√©ristiques suppl√©mentaires (visible dynamiquement) -->
<div id="features-section" style="display:none;">
    <h3>üõ†Ô∏è {{ _('Caract√©ristiques suppl√©mentaires') }}</h3>

    <div id="field-marque">
        <label for="marque">{{ _('Marque') }} :</label>
        <input type="text" name="marque" id="marque" placeholder="{{ _('Ex: Apple') }}">
    </div>

    <div id="field-modele">
        <label for="modele">{{ _('Mod√®le') }} :</label>
        <input type="text" name="modele" id="modele" placeholder="{{ _('Ex: MacBook Pro M3 16 pouces') }}">
    </div>

    <div id="field-fermeture">
        <label for="fermeture">{{ _('Type de fermeture') }} :</label>
        <input type="text" name="fermeture" id="fermeture" placeholder="{{ _('Ex: Fermeture √©clair, Boutons, Lacets') }}">
    </div>

    <div id="field-matiere">
        <label for="matiere">{{ _('Mati√®re') }} :</label>
        <input type="text" name="matiere" id="matiere" placeholder="{{ _('Ex: Coton, Cuir, Jean, Polyester') }}">
    </div>
</div>
          <!-- üì¶ Informations logistiques et pratiques -->
<h3>üì¶ {{ _('Informations compl√©mentaires') }}</h3>

<!-- ‚úÖ Poids -->
<label for="poids">{{ _('Poids (en kg)') }} :</label>
<input type="number" name="poids" id="poids" step="0.01" min="0" placeholder="{{ _('Ex : 1.25') }}">

<!-- ‚úÖ Dimensions -->
<label for="dimensions">{{ _('Dimensions (L √ó l √ó h en cm)') }} :</label>
<input type="text" name="dimensions" id="dimensions" placeholder="{{ _('Ex : 30 √ó 20 √ó 10') }}">

<!-- ‚úÖ Contenu du pack -->
<label for="contenu_pack">{{ _('Contenu du pack') }} :</label>
<textarea name="contenu_pack" id="contenu_pack" placeholder="{{ _('Ex : 1 c√¢ble USB, 1 manuel, 1 housse de transport') }}"></textarea>

<!-- ‚úÖ Tags / Mots-cl√©s -->
<label for="tags">{{ _('Mots-cl√©s (s√©par√©s par des virgules)') }} :</label>
<input type="text" name="tags" id="tags" placeholder="{{ _('Ex : bluetooth, rechargeable, sans fil, gaming') }}">

<!-- ‚úÖ Date d‚Äôexpiration de l‚Äôannonce -->
<label for="date_expiration">{{ _('Date de fin d\'affichage de l‚Äôannonce') }} :</label>
<input type="date" name="date_expiration" id="date_expiration">


        <!-- Images -->
        <h3>üñºÔ∏è {{ _('Images de l‚Äôarticle') }}</h3>
        <label for="images">{{ _('Images') }} :</label>

<input type="file" name="images[]" id="images" multiple accept="image/*" onchange="previewImages(this.files)">
<div id="image-preview-container"></div>
        <div id="main-image-container" style="text-align:center; margin-top: 20px;">
    <img id="mainProductImage" src="" alt="Image principale" style="max-width: 400px; border-radius: 10px;">
    <p id="priceDisplay" style="font-weight: bold; font-size: 1.2rem; margin-top: 10px;">Prix : {{ _('‚àí') }}</p>
</div>
<input type="hidden" name="main_image_index" id="main_image_index">


        <label for="video_file">{{ _('Vid√©o de d√©monstration (facultatif) (max 20 Mo, MP4 conseill√©)') }} :</label>
<input type="file" name="video_file" id="video_file" accept="video/*">
<div id="video-preview-container" style="margin-top: 10px;"></div>
<button type="button" id="remove-video-btn" style="display:none; margin-top:10px; background:#e74c3c; color:white; border:none; padding:6px 12px; border-radius:6px;">
    ‚ùå {{ _('Supprimer la vid√©o s√©lectionn√©e') }}
</button>

        <!-- Exp√©dition rapide -->
        <h3>üöÄ {{ _('Options d‚Äôexp√©dition') }}</h3>
        <label><input type="checkbox" name="expedition_rapide" id="expedition_rapide"> {{ _('Livr√© en 1 √† 3 jours üöÄ') }}</label>

        <!-- Bouton Publier -->
        <!-- Boutons -->
        <button type="button" class="btn-add" onclick="previewAnnonce()">{{ _('üëÅÔ∏è Aper√ßu') }}</button>
        <button type="submit" class="btn-publish">{{ _('üì¢ Publier l‚Äôannonce') }}</button>

    </form>
</div>

<script>
    const categories = {{ categories | tojson }};
    const examples = {{ examples | tojson }};

    const sousCategoriesAvecVariantes = [
    // üß• V√™tements & Mode
    "V√™tements hommes", "V√™tements femmes", "Vestes / Manteaux",
    "Chaussures hommes", "Chaussures femmes", "Accessoires",

    // üíª √âlectronique & Informatique
    "Smartphones", "Ordinateurs / Laptops", "Tablettes",

    // üõãÔ∏è Meubles & Maison
    "Lits / Matelas", "Chaises / Fauteuils", "Bureaux / Tables / √âtag√®res",
    "Armoires / Rangement", "D√©coration int√©rieure", "Cuisine & √©lectrom√©nager",

    // üç≥ Cuisine & Produits alimentaires
    "√âpices / Condiments", "Produits de base", "Boissons & Snacks", "Ustensiles sp√©cifiques",

    // üì£ Annonces diverses
    "Jeux vid√©os / Consoles", "Appareils photo / Cam√©ras", "Instruments de musique", "Objets divers",

    // ‚úàÔ∏è Voyages & Mobilit√©
    "Sacs / Valises / Backpacks"
];


    function updateSubcategories() {
        const catSelect = document.getElementById('category');
        const subSelect = document.getElementById('subcategory');
        const selectedCat = catSelect.value;

        subSelect.innerHTML = '<option value="">-- Sous-cat√©gorie --</option>';

        if (categories[selectedCat]) {
            categories[selectedCat].forEach(subcat => {
                const option = document.createElement('option');
                option.value = subcat;
                option.textContent = subcat;
                subSelect.appendChild(option);
            });
        }

        // Reset affichage des sections
        document.getElementById('variants-section').style.display = 'none';
        document.getElementById('features-section').style.display = 'none';
        document.getElementById('title-example').textContent = '';

        // ‚úÖ Mise √† jour automatique
        handleVariantVisibility();
        updateTitleExample();
    }

    function handleVariantVisibility() {
    const selectedSubcat = document.getElementById('subcategory').value;

    const showMarqueModele = [
    // üñ•Ô∏è √âlectronique & Informatique
    "Smartphones", "Ordinateurs / Laptops", "Tablettes",
    "Casques / √âcouteurs / Enceintes", "√âcrans / Claviers / Souris",
    "Disques durs / SSD / Cl√©s USB", "C√¢bles & Chargeurs", "Accessoires tech",

    // üëü V√™tements & Mode
    "Chaussures hommes", "Chaussures femmes", "Vestes / Manteaux", "Accessoires",

     "V√™tements hommes", "V√™tements femmes",

    // üè† Meubles & Maison
    "Cuisine & √©lectrom√©nager", "D√©coration int√©rieure",

    // üì∏ Annonces diverses
    "Appareils photo / Cam√©ras", "Instruments de musique", "Jeux vid√©os / Consoles",

    // ‚úàÔ∏è Voyages & Mobilit√©
    "Sacs / Valises / Backpacks",

    // üç≥ Cuisine & Produits alimentaires
    "Ustensiles sp√©cifiques",

    // üìö √âtudes & Livres
    "Fournitures scientifiques", "Mat√©riel de bureau"
];

// üì¶ Adapter le placeholder du contenu du pack
const packPlaceholder = exemplesContenuPackParSousCategorie[selectedSubcat];
if (packPlaceholder) {
    document.getElementById("contenu_pack").placeholder = `Ex : ${packPlaceholder}`;
} else {
    document.getElementById("contenu_pack").placeholder = "Ex : 1 c√¢ble USB, 1 manuel";
}

// üéØ Adapter le placeholder du mod√®le
const modelePlaceholder = exemplesModeleParSousCategorie[selectedSubcat];
if (modelePlaceholder) {
    document.getElementById("modele").placeholder = `Ex : ${modelePlaceholder}`;
} else {
    document.getElementById("modele").placeholder = "Ex : Mod√®le sp√©cifique";
}



    const showTextileFields = [
        "V√™tements hommes", "V√™tements femmes", "Vestes / Manteaux",
        "Chaussures femmes", "Chaussures hommes", "Accessoires"
    ];

    // Affichage conditionnel des champs individuels
    document.getElementById('field-marque').style.display = showMarqueModele.includes(selectedSubcat) ? 'block' : 'none';
    document.getElementById('field-modele').style.display = showMarqueModele.includes(selectedSubcat) ? 'block' : 'none';
    document.getElementById('field-fermeture').style.display = showTextileFields.includes(selectedSubcat) ? 'block' : 'none';
    document.getElementById('field-matiere').style.display = showTextileFields.includes(selectedSubcat) ? 'block' : 'none';

    // Affichage de la section variantes
    if (sousCategoriesAvecVariantes.includes(selectedSubcat)) {
        document.getElementById('variants-section').style.display = 'block';
    } else {
        document.getElementById('variants-section').style.display = 'none';
    }

    // Affichage de toute la section "Caract√©ristiques suppl√©mentaires"
    const hasVisibleFields = [
        document.getElementById('field-marque'),
        document.getElementById('field-modele'),
        document.getElementById('field-fermeture'),
        document.getElementById('field-matiere')
    ].some(el => el.style.display === 'block');

    document.getElementById('features-section').style.display = hasVisibleFields ? 'block' : 'none';
}

const exemplesParSousCategorie = {
    // üß• V√™tements & Mode
    "V√™tements hommes": " Taille / Couleur (Ex:M / Bleu)",
    "V√™tements femmes": " Taille / Couleur (Ex:S / Rouge)",
    "Vestes / Manteaux": " Taille / Couleur (Ex: L / Noir)",
    "Chaussures hommes": " Taille / Couleur (Ex: 42 / Marron)",
    "Chaussures femmes": " Taille / Couleur (Ex: 38 / Blanc)",
    "Accessoires": "Taille unique / Dor√©",

    // üíª √âlectronique & Informatique
    "Smartphones": "128 Go / Noir",
    "Ordinateurs / Laptops": "15\" / 512 Go / 16 Go RAM / Argent",
    "Tablettes": "11\" / 256 Go / Wi-Fi / Gris",
    "Casques / √âcouteurs / Enceintes": "Version 2 / Blanc",
    "√âcrans / Claviers / Souris": "24\" / Gaming / Noir",
    "Disques durs / SSD / Cl√©s USB": "1To / USB 3.0 / Noir",
    "C√¢bles & Chargeurs": "2m / 65W / USB-C / Blanc",
    "Accessoires tech": "Support pliable / M√©tal / Noir",

    // üõãÔ∏è Meubles & Maison
    "Lits / Matelas": "140x200 / Ch√™ne clair",
    "Chaises / Fauteuils": "Lot de 2 / Blanc",
    "Bureaux / Tables / √âtag√®res": "120x60 / Bois fonc√©",
    "Armoires / Rangement": "3 portes / Blanc mat",
    "D√©coration int√©rieure": "Lot de 3 cadres / Dor√©",
    "Cuisine & √©lectrom√©nager": "23L / Micro-ondes / Inox",

    // üç≥ Cuisine & Produits alimentaires
    "√âpices / Condiments": "200g / Curcuma / Bio",
    "Produits de base": "5kg / Riz parfum√©",
    "Boissons & Snacks": "Pack x6 / Mangue / Frais",
    "Ustensiles sp√©cifiques": "24cm / Fonte / Rouge",

    // üì£ Annonces diverses
    "Jeux vid√©os / Consoles": "PS5 / Standard / 1 manette / Blanc",
    "Appareils photo / Cam√©ras": "Canon EOS / 50mm / Noir",
    "Instruments de musique": "Guitare classique / Avec housse / Bois clair",
    "Objets divers": "Lot x3 / Couleurs vari√©es",

    // ‚úàÔ∏è Voyages & Mobilit√©
    "Sacs / Valises / Backpacks": "40L / √âtanche / Noir"
};

const exemplesContenuPackParSousCategorie = {
    "Smartphones": "1 c√¢ble USB-C, 1 coque, 1 chargeur",
    "Ordinateurs / Laptops": "Chargeur, souris sans fil, housse",
    "Casques / √âcouteurs / Enceintes": "Casque, c√¢ble jack, housse",
    "Lits / Matelas": "Cadre, visserie, cl√© Allen",
    "Chaises / Fauteuils": "2 chaises, coussins",
    "Jeux vid√©os / Consoles": "Console, manette, c√¢ble HDMI",
    "Objets divers": "3 stylos, 1 lampe, 1 carnet"
};

const exemplesModeleParSousCategorie = {
    "Smartphones": "iPhone 13 Pro, Galaxy S23",
    "Ordinateurs / Laptops": "MacBook Pro M2, HP Envy x360",
    "Chaussures hommes": "Air Max 90, Timberland Classic",
    "V√™tements femmes": "Zara Oversize, Levi's 501",
    "Vestes / Manteaux": "North Face Nuptse, Adidas Windbreaker",
    "Appareils photo / Cam√©ras": "Canon EOS 90D, Nikon D5600"
};


    function addVariantRow() {
    const container = document.getElementById('variants-container');
    const newRow = document.createElement('div');
    newRow.className = 'variant-row';
    newRow.style.flexDirection = 'column';
    newRow.style.gap = '6px';

    const selectedSubcat = document.getElementById('subcategory').value;

    // Premi√®re ligne : nom, stock, prix, image
    const row1 = document.createElement('div');
    row1.style.display = 'flex';
    row1.style.gap = '10px';

    const input1 = document.createElement('input');
    input1.name = "variant_name[]";
    input1.placeholder = exemplesParSousCategorie[selectedSubcat] || "{{ _('Nom de la variante (ex : Taille / Couleur / Capacit√©)') }}";
    input1.style.flex = "1";

    const input2 = document.createElement('input');
    input2.placeholder = "{{ _('Stock') }}";
    input2.type = "number";
    input2.min = "0";
    input2.name = "variant_stock[]";
    input2.style.flex = "1";

    const input3 = document.createElement('input');
    input3.placeholder = "{{ _('Prix (RUB)') }}";
    input3.type = "number";
    input3.step = "0.01";
    input3.name = "variant_price[]";
    input3.style.flex = "1";

    const input4 = document.createElement('input');
    input4.type = "file";
    input4.name = "variant_image[]";
    input4.accept = "{{ _('Image/*') }}";
    input4.style.flex = "2";

    row1.appendChild(input1);
    row1.appendChild(input2);
    row1.appendChild(input3);
    row1.appendChild(input4);

    // Deuxi√®me ligne : promo + dates
    const row2 = document.createElement('div');
    row2.style.display = 'flex';
    row2.style.gap = '10px';

    const input5 = document.createElement('input');
    input5.placeholder = "{{ _('Prix initial') }}";
    input5.type = "number";
    input5.step = "0.01";
    input5.name = "variant_original_price[]";
    input5.style.flex = "1";

    const input6 = document.createElement('input');
    input6.placeholder = "{{ _('Prix promo') }}";
    input6.type = "number";
    input6.step = "0.01";
    input6.name = "variant_discount_price[]";
    input6.style.flex = "1";

    const input7 = document.createElement('input');
    input7.type = "datetime-local";
    input7.name = "variant_promo_start[]";
    input7.style.flex = "1.2";

    const input8 = document.createElement('input');
    input8.type = "datetime-local";
    input8.name = "variant_promo_end[]";
    input8.style.flex = "1.2";

    const removeButton = document.createElement('button');
    removeButton.className = 'btn-remove';
    removeButton.type = "button";
    removeButton.textContent = '‚àí';
    removeButton.onclick = () => newRow.remove();

    row2.appendChild(input5);
    row2.appendChild(input6);
    row2.appendChild(input7);
    row2.appendChild(input8);
    row2.appendChild(removeButton);

    newRow.appendChild(row1);
    newRow.appendChild(row2);
    container.appendChild(newRow);
}



    function updateTitleExample() {
    const subcat = document.getElementById('subcategory').value;
    const exampleEl = document.getElementById('title-example');
    const marqueInput = document.getElementById('marque');
    const modeleInput = document.getElementById('modele');

    if (!subcat) {
        exampleEl.textContent = '';
        marqueInput.placeholder = "Ex: Apple";
        modeleInput.placeholder = "Ex: MacBook Pro M3 16 pouces";
        return;
    }

    let exampleText = '';
    let marquePlaceholder = '';
    let modelePlaceholder = '';

    switch (subcat) {
        case "Smartphones":
            exampleText = "Ex: iPhone 14 Pro Max 256GB - Comme Neuf";
            marquePlaceholder = "Ex: Apple";
            modelePlaceholder = "Ex: iPhone 14 Pro Max";
            break;
        case "Ordinateurs / Laptops":
            exampleText = "Ex: MacBook Air M1 256 Go - Tr√®s bon √©tat";
            marquePlaceholder = "Ex: Apple";
            modelePlaceholder = "Ex: MacBook Air M1";
            break;
        case "Tablettes":
            exampleText = "Ex: iPad Pro 11 pouces 128 Go - Tr√®s bon √©tat";
            marquePlaceholder = "Ex: Apple";
            modelePlaceholder = "Ex: iPad Pro 11";
            break;
        case "Casques / √âcouteurs / Enceintes":
            exampleText = "Ex: AirPods Pro 2√®me g√©n√©ration - Neufs";
            marquePlaceholder = "Ex: Apple";
            modelePlaceholder = "Ex: AirPods Pro 2";
            break;
        case "√âcrans / Claviers / Souris":
            exampleText = "Ex: √âcran Dell 24 pouces Full HD - Tr√®s bon √©tat";
            marquePlaceholder = "Ex: Dell";
            modelePlaceholder = "Ex: Dell P2419H";
            break;
        case "Disques durs / SSD / Cl√©s USB":
            exampleText = "Ex: SSD Samsung 1To - Neuf";
            marquePlaceholder = "Ex: Samsung";
            modelePlaceholder = "Ex: 870 EVO 1To";
            break;
        case "C√¢bles & Chargeurs":
            exampleText = "Ex: Chargeur USB-C 65W - Universel";
            marquePlaceholder = "Ex: Anker";
            modelePlaceholder = "Ex: PowerPort III";
            break;
        case "Accessoires tech":
            exampleText = "Ex: Souris Logitech MX Master 3 - Neuve";
            marquePlaceholder = "Ex: Logitech";
            modelePlaceholder = "Ex: MX Master 3";
            break;
        case "V√™tements hommes":
            exampleText = "Ex: T-shirt Nike taille M - Bleu";
            marquePlaceholder = "Ex: Nike";
            modelePlaceholder = "";
            break;
        case "V√™tements femmes":
            exampleText = "Ex: Robe Zara taille S - Tr√®s bon √©tat";
            marquePlaceholder = "Ex: Zara";
            modelePlaceholder = "";
            break;
        case "Vestes / Manteaux":
            exampleText = "Ex: Manteau H&M long - taille L";
            marquePlaceholder = "Ex: H&M";
            modelePlaceholder = "";
            break;
        case "Chaussures femmes":
            exampleText = "Ex: Talons Zara taille 38 - Neufs";
            marquePlaceholder = "Ex: Zara";
            modelePlaceholder = "";
            break;
        case "Chaussures hommes":
            exampleText = "Ex: Baskets Adidas taille 42 - Bon √©tat";
            marquePlaceholder = "Ex: Adidas";
            modelePlaceholder = "";
            break;
        case "Accessoires":
            exampleText = "Ex: Sac √† main Guess noir";
            marquePlaceholder = "Ex: Guess";
            modelePlaceholder = "";
            break;
        case "Jeux vid√©os / Consoles":
            exampleText = "Ex: PS5 avec 2 manettes + FIFA 24";
            marquePlaceholder = "Ex: Sony";
            modelePlaceholder = "Ex: PlayStation 5";
            break;
        case "Manuels & Livres universitaires":
            exampleText = "Ex: Manuel de math√©matiques MPSI - √©dition 2023";
            break;
        case "Cours imprim√©s / Polycopi√©s":
            exampleText = "Ex: Polycopi√© physique-chimie semestre 1";
            break;
        case "Revente de billets de train / avion":
            exampleText = "Ex: Billet TGV Paris ‚Üí Lyon - 22 juin";
            break;
        case "Colocation disponible":
            exampleText = "Ex: Chambre en colocation proche campus";
            break;
        default:
            exampleText = "Titre de votre annonce";
        case "Fiches de r√©vision / R√©sum√©s":
            exampleText = "Ex: Fiches de r√©vision math√©matiques - Pr√©pa scientifique";
            break;
        case "Mat√©riel de bureau":
            exampleText = "Ex: Agrafeuse √©lectrique Leitz - Tr√®s bon √©tat";
            break;
        case "Fournitures scientifiques":
            exampleText = "Ex: Micropipette Gilson P20 - Comme neuve";
            break;
        case "Lits / Matelas":
        exampleText = "Ex: Lit double IKEA avec matelas 140x200 - Bon √©tat";
        break;
    case "Chaises / Fauteuils":
        exampleText = "Ex: 2 chaises design noires en m√©tal - Neuves";
        break;
    case "Bureaux / Tables / √âtag√®res":
        exampleText = "Ex: Bureau en bois massif 120cm + √©tag√®re";
        break;
    case "Armoires / Rangement":
        exampleText = "Ex: Armoire 3 portes blanche - Tr√®s bon √©tat";
        break;
    case "D√©coration int√©rieure":
        exampleText = "Ex: Lot de cadres muraux + lampe d√©co";
        break;
    case "Cuisine & √©lectrom√©nager":
        exampleText = "Ex: Micro-ondes Samsung 25L - Tr√®s bon √©tat";
        break;

    // Logement
    case "Colocation disponible":
        exampleText = "Ex: Chambre en colocation √† 5 min du campus";
        break;
    case "Studio / Appartement √† louer":
        exampleText = "Ex: Studio meubl√© 22m¬≤ √† louer - Centre-ville";
        break;
    case "Chambre libre chez l‚Äôhabitant":
        exampleText = "Ex: Chambre chez l‚Äôhabitant - Calme et lumineuse";
        break;
    case "Sous-location courte dur√©e":
        exampleText = "Ex: Sous-location 1 mois - Studio √©quip√© √† Amsterdam";
        break;
    case "√âchange temporaire de logement":
        exampleText = "Ex: √âchange studio Paris contre chambre √† Bruxelles";
        break;

    // Produits alimentaires
    case "√âpices / Condiments":
        exampleText = "Ex: Lot d'√©pices indiennes + sauces piquantes";
        break;
    case "Nourriture africaine / asiatique":
        exampleText = "Ex: Atti√©k√©, gombo, gari - produits africains";
        break;
    case "Produits de base":
        exampleText = "Ex: Riz, huile, sucre - en lot (neuf)";
        break;
    case "Boissons & Snacks":
        exampleText = "Ex: Boissons tropicales + snacks asiatiques";
        break;
    case "Ustensiles sp√©cifiques":
        exampleText = "Ex: Mortier en bois + cocotte traditionnelle";
        break;

    // Transport
    case "Sacs / Valises / Backpacks":
        exampleText = "Ex: Sac √† dos Eastpak 30L - Neuf";
        break;
    case "Revente de billets de train / avion":
        exampleText = "Ex: Billet Train Kazan ‚Üí Moscou - 3 juillet";
        break;
    case "Covoiturage":
        exampleText = "Ex: Trajet Moscou ‚Üí Saransk - 24 juin (2 places dispo)";
        break;
    case "Location de v√©hicule / trottinette":
        exampleText = "Ex: Trottinette √©lectrique √† louer - 200 Rub/jour";
        break;
    case "Cartes de transport / Abonnements":
        exampleText = "Ex: Carte de Bus valable jusqu'√† fin juin";
        break;
    // Services entre √©tudiants
    case "Cours particuliers / Aide scolaire":
    exampleText = "Ex: Cours de Marketing Digital niveau L3‚Äì Prof exp√©riment√©";
    break;
case "Correction de devoirs / M√©moire":
    exampleText = "Ex: Relecture + correction m√©moire de licence ‚Äì Rapide";
    break;
case "Traductions / Mise en page / CV":
    exampleText = "Ex: Traduction Anglais ‚Üí fran√ßais ou Russe ‚Üí fran√ßais + mise en page CV";
    break;
case "M√©nage / Repassage / Courses":
    exampleText = "Ex: Aide m√©nage 2h/semaine; ‚Äì Quartier Sud";
    break;
case "Soins personnels":
    exampleText = "Ex: Coiffure √† domicile ‚Äì Tresses ou d√©frisage";
    break;
case "Envoi de colis / Retrait":
    exampleText = "Ex: Retrait de colis √† l'a√©roport  + d√©p√¥t poste ‚Äì dispo soir";
    break;
case "Soutien administratif":
    exampleText = "Ex: Aide d√©marches Campus Russie / dossier campus France";
    break;

// Loisirs & culture
case "√âv√©nements / Soir√©es / Concerts":
    exampleText = "Ex: Soir√©e afro pr√©vue vendredi ‚Äì entr√©e gratuite";
    break;
case "Appareils photo / Cam√©ras":
    exampleText = "Ex: Appareil photo Canon EOS 2000D ‚Äì Comme neuf";
    break;
case "Instruments de musique":
    exampleText = "Ex: Guitare classique Yamaha ‚Äì Tr√®s bon √©tat";
    break;
case "Objets perdus / retrouv√©s":
    exampleText = "Ex: Porte-feuille noir perdu pr√®s du campus";
    break;
case "Objets divers":
    exampleText = "Ex: Lot d‚Äôobjets utiles (lampe, multiprise, rideaux)";
    break;

// Annonces de recherche
case "Recherche de logement":
    exampleText = "Ex: Cherche studio proche universit√© ‚Äì budget max 30 000 Rub";
    break;
case "Recherche de colocataire":
    exampleText = "Ex: Recherche colocataire pour T3 Moscou";
    break;
case "Recherche d‚Äôobjet":
    exampleText = "Ex: Recherche v√©lo d‚Äôoccasion pas trop cher";
    break;
case "Recherche de service":
    exampleText = "Ex: Besoin aide informatique pour installation PC";
    break;
case "Demande de transport":
    exampleText = "Ex: Cherche trajet Saint Peter ‚Üí Moscou ce week-end";
    break;
case "Lits / Matelas":
    exampleText = "Ex: Lit IKEA 140x200 avec tiroirs ‚Äì Bon √©tat";
    break;

case "Chaises / Fauteuils":
    exampleText = "Ex: Lot de 2 chaises design ‚Äì Couleur blanc";
    break;

case "Bureaux / Tables / √âtag√®res":
    exampleText = "Ex: Bureau bois clair 120cm ‚Äì comme neuf";
    break;

case "Armoires / Rangement":
    exampleText = "Ex: Armoire 3 portes avec miroir ‚Äì blanc";
    break;

case "D√©coration int√©rieure":
    exampleText = "Ex: Set de 3 cadres dor√©s ‚Äì style minimaliste";
    break;

case "Cuisine & √©lectrom√©nager":
    exampleText = "Ex: Micro-ondes Samsung 23L ‚Äì noir";
    break;

case "√âpices / Condiments":
    exampleText = "Ex: Curcuma bio 200g ‚Äì neuf";
    break;

case "Produits de base":
    exampleText = "Ex: Riz parfum√© Tha√Ø ‚Äì 5kg";
    break;

case "Boissons & Snacks":
    exampleText = "Ex: Pack de jus exotiques x6 ‚Äì Mango/Passion";
    break;

case "Ustensiles sp√©cifiques":
    exampleText = "Ex: Casserole fonte 24cm ‚Äì rouge";
    break;

case "Objets divers":
    exampleText = "Ex: Lot multiprise + lampe + support t√©l√©phone";
    break;

case "Sacs / Valises / Backpacks":
    exampleText = "Ex: Sac √† dos 40L ‚Äì √©tanche ‚Äì noir/gris";
    break;

    }

    exampleEl.textContent = exampleText;

    // Appliquer les placeholders seulement si les inputs existent
    if (marqueInput) marqueInput.placeholder = marquePlaceholder;
    if (modeleInput) modeleInput.placeholder = modelePlaceholder;
}

// √âv√©nements
document.getElementById('category').addEventListener('change', () => {
    updateSubcategories();
    handleVariantVisibility();
    updateTitleExample();
});

document.getElementById('subcategory').addEventListener('change', () => {
    handleVariantVisibility();
    updateTitleExample();
});

document.getElementById('title').addEventListener('input', () => {
    updateTitleExample();
});

// Initialisation au chargement de la page
window.addEventListener('DOMContentLoaded', () => {
    updateSubcategories();
    handleVariantVisibility();
    updateTitleExample();
});

function previewImages(files) {
    const previewContainer = document.getElementById('image-preview-container');
    previewContainer.innerHTML = '';

    // R√©cup√©rer les prix des variantes (inputs variant_price[])
    const prices = Array.from(document.getElementsByName('variant_price[]')).map(input => input.value);

    Array.from(files).forEach((file, index) => {
        const reader = new FileReader();

        reader.onload = function(e) {
            const wrapper = document.createElement('div');
            wrapper.style.display = 'inline-block';
            wrapper.style.margin = '10px';
            wrapper.style.position = 'relative';

            const img = document.createElement('img');
            img.src = e.target.result;
            img.style.width = '120px';
            img.style.height = '120px';
            img.style.objectFit = 'cover';
            img.style.border = '3px solid transparent';
            img.style.borderRadius = '10px';
            img.style.cursor = 'pointer';

            // Ajout du prix comme data-attribute
            if (prices[index]) {
                img.setAttribute('data-price', prices[index]);
            }

            // Au survol : afficher le prix
            img.onmouseenter = () => {
                const priceDisplay = document.getElementById('priceDisplay');
                if (priceDisplay && img.getAttribute('data-price')) {
                    priceDisplay.textContent = "Prix : " + img.getAttribute('data-price') + " ‚ÇΩ";
                }
            };

            // Au d√©part du survol : remettre prix par d√©faut
            img.onmouseleave = () => {
                const priceDisplay = document.getElementById('priceDisplay');
                if (priceDisplay) {
                    priceDisplay.textContent = "Prix : -";
                }
            };

            // Au clic : s√©lection image principale + mise √† jour prix
            img.onclick = () => {
                // Bordure pour montrer la s√©lection
                document.querySelectorAll('#image-preview-container img').forEach(img => img.style.border = '3px solid transparent');
                img.style.border = '3px solid #3498db';

                document.getElementById('main_image_index').value = index;

                // Met √† jour l'image principale et le prix
                const mainImg = document.getElementById('mainProductImage');
                const priceDisplay = document.getElementById('priceDisplay');
                if (mainImg) mainImg.src = e.target.result;
                if (priceDisplay && img.getAttribute('data-price')) {
                    priceDisplay.textContent = "Prix : " + img.getAttribute('data-price') + " ‚ÇΩ";
                }
            };

            const label = document.createElement('div');
            label.textContent = "Image " + (index + 1);
            label.style.textAlign = "center";
            label.style.marginTop = "5px";
            label.style.fontSize = "0.85rem";

            wrapper.appendChild(img);
            wrapper.appendChild(label);
            previewContainer.appendChild(wrapper);
        };

        reader.readAsDataURL(file);
    });

    // Par d√©faut, s√©lectionner la premi√®re image et afficher son prix
    document.getElementById('main_image_index').value = 0;

    // Petite attente pour que la premi√®re image soit bien charg√©e avant de l'afficher
    setTimeout(() => {
        const firstImg = previewContainer.querySelector('img');
        if (firstImg) firstImg.click();
    }, 300);
}
</script>

<script>
function previewImages(files) {
    const container = document.getElementById('image-preview-container');
    container.innerHTML = ''; // On vide les anciennes previews

    Array.from(files).forEach((file, index) => {
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.maxWidth = '120px';
                img.style.margin = '8px';
                img.style.borderRadius = '8px';
                img.style.border = '1px solid #ccc';
                img.title = file.name;

                // Quand on clique sur une image, elle devient l‚Äôimage principale
                img.onclick = () => {
                    document.getElementById('main_image_index').value = index;
                    document.querySelectorAll('#image-preview-container img').forEach(i => i.style.border = '1px solid #ccc');
                    img.style.border = '3px solid #27ae60';
                }

                container.appendChild(img);
            };
            reader.readAsDataURL(file);
        }
    });
}
</script>

    <script>
function previewAnnonce() {
    const title = document.getElementById('title').value;
    const description = document.getElementById('description').value;
    const price = document.getElementById('price').value;
    const video = document.getElementById('video').value;
    const mainImg = document.getElementById('mainProductImage').src;

    let content = `
        <h4>${title}</h4>
        <img src="${mainImg}" alt="Image" style="max-width:100%; border-radius:8px; margin-top:10px;"><br><br>
        <strong>Prix :</strong> ${price} ‚ÇΩ<br><br>
        <strong>Description :</strong><br>
        <p>${description}</p>
    `;

    if (video) {
        const embedUrl = video.replace("watch?v=", "embed/");
        content += `<strong>Vid√©o :</strong><br><iframe width="100%" height="300" src="${embedUrl}" frameborder="0" allowfullscreen style="border-radius:10px;"></iframe>`;
    }

    document.getElementById('previewContent').innerHTML = content;
    document.getElementById('previewModal').style.display = "flex";
}

function closePreview() {
    document.getElementById('previewModal').style.display = "none";
}
</script>

    <script>
function previewVideo(files) {
    const container = document.getElementById('video-preview-container');
    container.innerHTML = ''; // Reset

    if (files.length === 0) return;

    const file = files[0];

    if (file.type.startsWith('video/')) {
        const video = document.createElement('video');
        video.controls = true;
        video.style.maxWidth = '100%';
        video.style.borderRadius = '10px';
        video.style.marginTop = '10px';

        const source = document.createElement('source');
        source.src = URL.createObjectURL(file);
        source.type = file.type;

        video.appendChild(source);
        container.appendChild(video);
    } else {
        container.innerHTML = "<p style='color:red;'>Fichier non valide. Veuillez choisir une vid√©o.</p>";
    }
}

<!-- Aper√ßu Modal -->
<div id="previewModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background-color:rgba(0,0,0,0.7); z-index:9999; justify-content:center; align-items:center;">
  <div style="background:white; padding:20px; border-radius:10px; max-width:600px; width:90%; overflow-y:auto; max-height:80%;">
    <h3 style="text-align:center;">{{ _('Aper√ßu de l‚Äôannonce') }}</h3>
    <div id="previewContent"></div>
    <button onclick="closePreview()" class="btn-publish" style="margin-top:20px;">{{ _('Fermer') }}priceDisplay</button>
  </div>
</div>
</script>

    <script>
const videoInput = document.getElementById('video_file');
const previewContainer = document.getElementById('video-preview-container');
const removeBtn = document.getElementById('remove-video-btn');

videoInput?.addEventListener('change', function(event) {
    const file = event.target.files[0];
    previewContainer.innerHTML = '';
    removeBtn.style.display = 'none';

    if (file) {
        const allowed = ['mp4', 'mov', 'avi', 'mkv', 'webm'];
        const ext = file.name.split('.').pop().toLowerCase();

        if (!allowed.includes(ext)) {
            alert("‚ùå Format non autoris√©. Vid√©os autoris√©es : mp4, mov, avi, mkv, webm");
            event.target.value = '';
            return;
        }

        if (file.size > 20 * 1024 * 1024) {
            alert("‚ùå Vid√©o trop lourde (max 20 Mo).");
            event.target.value = '';
            return;
        }

        const video = document.createElement('video');
        video.controls = true;
        video.width = 320;
        video.src = URL.createObjectURL(file);
        previewContainer.appendChild(video);
        removeBtn.style.display = 'inline-block';
    }
});

removeBtn?.addEventListener('click', function () {
    videoInput.value = '';
    previewContainer.innerHTML = '';
    removeBtn.style.display = 'none';
});
</script>


{% endblock %}
